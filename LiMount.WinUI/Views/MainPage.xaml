<?xml version="1.0" encoding="UTF-8" ?>
<Page
    x:Class="LiMount.WinUI.Views.MainPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:automation="using:Microsoft.UI.Xaml.Automation"
    Background="{StaticResource BackgroundBrush}">

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <!-- Header/Instructions -->
            <RowDefinition Height="Auto"/>
            <!-- Main Content -->
            <RowDefinition Height="*"/>
            <!-- Status/Log -->
            <RowDefinition Height="Auto"/>
            <!-- Buttons -->
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header Section -->
        <StackPanel Grid.Row="0" Margin="0,0,0,20">
            <TextBlock Text="LiMount"
                       FontSize="24"
                       FontWeight="SemiBold"
                       Foreground="{StaticResource TextPrimaryBrush}"
                       Margin="0,0,0,8"
                       AutomationProperties.HeadingLevel="Level1"/>
            <TextBlock Text="Mount Linux disk partitions into WSL2 and map them as Windows drive letters"
                       FontSize="13"
                       Foreground="{StaticResource TextSecondaryBrush}"
                       TextWrapping="Wrap"/>
        </StackPanel>

        <!-- Main Content Section -->
        <Border Grid.Row="1"
                Background="{StaticResource SurfaceBrush}"
                BorderBrush="{StaticResource BorderBrush}"
                BorderThickness="1"
                CornerRadius="4"
                Padding="20">
            <ScrollViewer VerticalScrollBarVisibility="Auto"
                          HorizontalScrollMode="Disabled"
                          HorizontalScrollBarVisibility="Disabled">
                <StackPanel Padding="0,0,12,0">
                    <!-- Disk Selection -->
                    <TextBlock Text="Select Disk"
                               FontSize="14"
                               FontWeight="SemiBold"
                               Foreground="{StaticResource TextPrimaryBrush}"
                               Margin="0,0,0,8"
                               x:Name="DiskLabel"/>
                    <ComboBox x:Name="DiskComboBox"
                              Style="{StaticResource ModernComboBox}"
                              ItemsSource="{Binding Disks}"
                              SelectedItem="{Binding SelectedDisk, Mode=TwoWay}"
                              DisplayMemberPath="DisplayName"
                              Margin="0,0,0,20"
                              IsEnabled="{Binding IsBusy, Converter={StaticResource InverseBooleanConverter}}"
                              AutomationProperties.Name="Select Disk"
                              automation:AutomationProperties.AutomationId="DiskComboBox"
                              AutomationProperties.LabeledBy="{Binding ElementName=DiskLabel}"
                              TabIndex="1"/>

                    <!-- Partition Selection -->
                    <TextBlock Text="Select Partition"
                               FontSize="14"
                               FontWeight="SemiBold"
                               Foreground="{StaticResource TextPrimaryBrush}"
                               Margin="0,0,0,8"
                               x:Name="PartitionLabel"/>
                    <ComboBox x:Name="PartitionComboBox"
                              Style="{StaticResource ModernComboBox}"
                              ItemsSource="{Binding Partitions}"
                              SelectedItem="{Binding SelectedPartition, Mode=TwoWay}"
                              DisplayMemberPath="DisplayName"
                              Margin="0,0,0,20"
                              IsEnabled="{Binding IsBusy, Converter={StaticResource InverseBooleanConverter}}"
                              AutomationProperties.Name="Select Partition"
                              automation:AutomationProperties.AutomationId="PartitionComboBox"
                              AutomationProperties.LabeledBy="{Binding ElementName=PartitionLabel}"
                              TabIndex="2"/>

                    <!-- Drive Letter Selection -->
                    <TextBlock Text="Select Drive Letter"
                               FontSize="14"
                               FontWeight="SemiBold"
                               Foreground="{StaticResource TextPrimaryBrush}"
                               Margin="0,0,0,8"
                               x:Name="DriveLetterLabel"/>
                    <ComboBox x:Name="DriveLetterComboBox"
                              Style="{StaticResource ModernComboBox}"
                              ItemsSource="{Binding FreeDriveLetters}"
                              SelectedItem="{Binding SelectedDriveLetter, Mode=TwoWay}"
                              Margin="0,0,0,20"
                              IsEnabled="{Binding IsBusy, Converter={StaticResource InverseBooleanConverter}}"
                              AutomationProperties.Name="Select Drive Letter"
                              automation:AutomationProperties.AutomationId="DriveLetterComboBox"
                              AutomationProperties.LabeledBy="{Binding ElementName=DriveLetterLabel}"
                              TabIndex="3">
                        <ComboBox.ItemTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding Converter={StaticResource CharToFormattedStringConverter}}"/>
                            </DataTemplate>
                        </ComboBox.ItemTemplate>
                    </ComboBox>

                    <!-- Detected Filesystem Type -->
                    <TextBlock Text="Detected Filesystem"
                               FontSize="14"
                               FontWeight="SemiBold"
                               Foreground="{StaticResource TextPrimaryBrush}"
                               Margin="0,0,0,8"/>
                    <Border Background="{StaticResource SurfaceBrush}"
                            BorderBrush="{StaticResource BorderBrush}"
                            BorderThickness="1"
                            CornerRadius="4"
                            Padding="12,8"
                            Margin="0,0,0,20">
                        <TextBlock Text="{Binding DetectedFileSystem}"
                                   FontSize="18"
                                   FontWeight="Bold"
                                   Foreground="{StaticResource PrimaryBrush}"
                                   AutomationProperties.Name="Detected filesystem type"
                                   AutomationProperties.LiveSetting="Polite"/>
                    </Border>
                </StackPanel>
            </ScrollViewer>
        </Border>

        <!-- Status Section -->
        <Border Grid.Row="2"
                Background="{StaticResource SurfaceBrush}"
                BorderBrush="{StaticResource BorderBrush}"
                BorderThickness="1"
                CornerRadius="4"
                Padding="12"
                Margin="0,12,0,12">
            <StackPanel>
                <TextBlock Text="Status"
                           FontSize="12"
                           FontWeight="SemiBold"
                           Foreground="{StaticResource TextSecondaryBrush}"
                           Margin="0,0,0,6"/>
                <TextBlock x:Name="StatusTextBlock"
                           Text="{Binding StatusMessage}"
                           FontSize="13"
                           Foreground="{StaticResource TextPrimaryBrush}"
                           TextWrapping="Wrap"
                           MinHeight="20"
                           automation:AutomationProperties.AutomationId="StatusTextBlock"
                           AutomationProperties.LiveSetting="Polite"/>

                <!-- Progress indicator -->
                <ProgressBar x:Name="ProgressBar"
                             IsIndeterminate="True"
                             Height="4"
                             Margin="0,8,0,0"
                             Visibility="{Binding IsBusy, Converter={StaticResource BooleanToVisibilityConverter}}"
                             AutomationProperties.Name="Operation in progress"/>
            </StackPanel>
        </Border>

        <!-- Buttons Section -->
        <Grid Grid.Row="3">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <!-- Refresh Button -->
            <Button Grid.Column="0"
                    Content="Refresh"
                    Style="{StaticResource SecondaryButton}"
                    Command="{Binding RefreshCommand}"
                    MinWidth="100"
                    Margin="0,0,8,0"
                    AutomationProperties.Name="Refresh disk and drive letter list"
                    automation:AutomationProperties.AutomationId="RefreshButton"
                    TabIndex="4"/>

            <!-- View History Button -->
            <Button Grid.Column="1"
                    Content="View History"
                    Style="{StaticResource SecondaryButton}"
                    Command="{Binding OpenHistoryCommand}"
                    MinWidth="110"
                    Margin="0,0,8,0"
                    AutomationProperties.Name="View mount history"
                    automation:AutomationProperties.AutomationId="ViewHistoryButton"
                    TabIndex="5"/>

            <!-- Spacer -->

            <!-- Open in Explorer Button -->
            <Button Grid.Column="3"
                    x:Name="OpenExplorerButton"
                    Content="Open in Explorer"
                    Style="{StaticResource SecondaryButton}"
                    Command="{Binding OpenExplorerCommand}"
                    MinWidth="130"
                    Margin="0,0,8,0"
                    Visibility="{Binding CanOpenExplorer, Converter={StaticResource BooleanToVisibilityConverter}}"
                    AutomationProperties.Name="Open mounted drive in Windows Explorer"
                    automation:AutomationProperties.AutomationId="OpenExplorerButton"
                    TabIndex="6"/>

            <!-- Mount Button -->
            <Button Grid.Column="4"
                    Content="Mount"
                    Style="{StaticResource ModernButton}"
                    Command="{Binding MountCommand}"
                    MinWidth="120"
                    Margin="0,0,8,0"
                    AutomationProperties.Name="Mount selected partition to drive letter"
                    automation:AutomationProperties.AutomationId="MountButton"
                    TabIndex="7"/>

            <!-- Unmount Button -->
            <Button Grid.Column="5"
                    x:Name="UnmountButton"
                    Content="Unmount"
                    Style="{StaticResource SecondaryButton}"
                    Command="{Binding UnmountCommand}"
                    MinWidth="120"
                    Visibility="{Binding IsMounted, Converter={StaticResource BooleanToVisibilityConverter}}"
                    AutomationProperties.Name="Unmount current drive"
                    automation:AutomationProperties.AutomationId="UnmountButton"
                    TabIndex="8"/>
        </Grid>
    </Grid>
</Page>
